<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Yasa Tasker</title>
 <link rel="stylesheet" href="style.css">

 <!-- Load Pi SDK -->
 <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
 <h1>Welcome to Yasa Tasker</h1>
 <p>Test Pi login and payment integration.</p>

 <!-- Buttons will be added dynamically -->
 <button id="loginbutton">Log in with pi</button>
 <button id="paybutton">pay with pi</button>

 <script>
  // Initialize Pi SDK
  Pi.init({ version: "2.0" });

  // LOGIN button
    document.getElementById("loginButton").addEventListener("click", async () => {
   try {
     const scopes = ["username", "payments"];
     const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);
     alert("Welcome " + auth.user.username);
    } catch (err) {
      console.error(err);
     }
   });

   // PAYMENT button

document.getElementById("payButton").addEventListener("click", async () => {
      try {
       const payment = await Pi.createPayment({
        amount: 1,
        memo: "Test payment from Yasa Tasker",
        metadata: { jobId: "1234" },
        }, {
          onReadyForServerApproval: (paymentId) => { console.log("Ready", paymentId); },
          onReadyForServerCompletion: (paymentId) => { console.log("Complete", paymentId); },
          onCancel: (paymentId) => { console.log("Cancelled", paymentId); },
          onError: (error, payment) => { console.error(error); }
        });

        console.log("Payment object:", payment);
      } catch (err) {
        console.error("Payment failed:", err);
      }
    });

    // Incomplete payment handler
    function onIncompletePaymentFound(payment) {
      console.log("Incomplete payment:", payment);
    }
  </script>
<script>
  // Debug helper — shows alerts so you can see what's running on Android Pi Browser
  alert("Debug: script loaded");

  document.addEventListener("DOMContentLoaded", function () {
    const lb = document.getElementById("loginButton");
    if (!lb) {
      alert("Debug: loginButton NOT found");
      return;
    }
    alert("Debug: loginButton FOUND");

    lb.addEventListener("click", function () {
      alert("Debug: login clicked");
      if (typeof Pi === "undefined") {
        alert("Debug: Pi is UNDEFINED (SDK not loaded or origin not allowed)");
        return;
      }
      alert("Debug: Pi is DEFINED (SDK loaded)");
      // don't call authenticate yet — just confirm SDK exists first
    });
  });
</script>

</body>
</html>