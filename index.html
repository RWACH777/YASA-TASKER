<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yasa Tasker</title>
  <!-- Pi SDK -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>

  <!-- Styling -->
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0a1f44; /* Dark blue background */
      margin: 0;
      padding: 0;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      margin-top: 30px;
      margin-bottom: 10px;
      text-align: center;
      font-size: 2.5rem;
    }

    p.subtitle {
      color: #cbd5e1;
      margin-bottom: 30px;
      text-align: center;
    }

    .container {
      width: 90%;
      max-width: 800px;
      background-color: #13294b; /* Darker card */
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      margin-bottom: 30px;
    }

    .task {
      background-color: #1a3660;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .task h3 {
      margin: 0 0 10px 0;
    }

    .task p {
      margin: 5px 0;
    }

    .buttons {
      display: flex;
      gap: 15px;
      margin-top: 15px;
    }

    button {
      padding: 12px 25px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s, background 0.2s;
    }

    #loginButton {
      background-color: #ffd700;
      color: #000;
    }

    #loginButton:hover {
      transform: scale(1.05);
      background-color: #ffc300;
    }

    #payButton {
      background-color: #4caf50;
      color: #fff;
    }

    #payButton:hover {
      transform: scale(1.05);
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <h1>Yasa Tasker</h1>
  <p class="subtitle">Complete tasks and earn Pi. Platform takes 5% fee per payment.</p>

  <div class="container" id="taskContainer">
    <!-- Tasks will be inserted here dynamically -->
  </div>

  <div class="buttons">
    <button id="loginButton">Log in with Pi</button>
    <button id="payButton">Pay 1 Pi</button>
  </div>

  <script>
    // Example tasks
    const tasks = [
      { id: "1", title: "Design Logo", description: "Create a logo for a small business.", amount: 10 },
      { id: "2", title: "Write Blog Post", description: "Write a 500-word blog post.", amount: 5 },
      { id: "3", title: "Translate Text", description: "Translate a short text to French.", amount: 8 },
    ];

    const taskContainer = document.getElementById("taskContainer");

    tasks.forEach(task => {
      const div = document.createElement("div");
      div.className = "task";
      div.innerHTML = `
        <h3>${task.title}</h3>
        <p>${task.description}</p>
        <p>Amount: ${task.amount} Pi</p>
      `;
      taskContainer.appendChild(div);
    });

    let loggedInUser = null;

    // Wait until Pi SDK is fully loaded
    window.addEventListener("load", async () => {
      if (!Pi) {
        alert("Pi SDK not loaded! Check your internet connection.");
        return;
      }

      // Initialize Pi SDK
      Pi.init();

      // LOGIN BUTTON
      const loginButton = document.getElementById("loginButton");
      loginButton.addEventListener("click", async () => {
        try {
          const scopes = ['username', 'payments']; 
          const auth = await Pi.authenticate(scopes, null);
          loggedInUser = auth.user;
          alert("Welcome " + loggedInUser.username + " to Yasa Tasker!");
          console.log("Auth result:", auth);
        } catch (err) {
          console.error("Login failed:", err);
          alert("Login failed: " + err);
        }
      });

      // PAY BUTTON
      const payButton = document.getElementById("payButton");
      payButton.addEventListener("click", async () => {
        if (!loggedInUser) {
          alert("Please log in first!");
          return;
        }

        // For demo, pay the first task as example
        const task = tasks[0]; // You can extend to select any task
        const fee = task.amount * 0.05; // 5% platform fee
        const total = task.amount + fee;

        try {
          const paymentData = {
            amount: total,
            memo: `Payment for "${task.title}" (5% platform fee included)`,
            metadata: { jobId: task.id, user: loggedInUser.username, fee }
          };
          const result = await Pi.createPayment(paymentData);
          alert(`Payment of ${total} Pi successful! (Task: ${task.title})`);
          console.log("Payment result:", result);
        } catch (err) {
          console.error("Payment failed:", err);
          alert("Payment failed: " + err);
        }
      });
    });
  </script>
</body>
</html>
